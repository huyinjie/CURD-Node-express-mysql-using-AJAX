<!DOCTYPE html>
<html>

<head>
	<title><%=title%></title>
	<script type="text/javascript" src="js/jquery.js"></script>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
</head>

<body>
	<div class="data-table">
		<table border="1" cellpadding="7" cellspacing="7">
			<tr>
				<th width="50px">Index</th>
				<th>UserName</th>
				<th>Name</th>
				<th>Password</th>
				<th>Club</th>
				<th>Action</th>
			</tr>

			<% if(data.length){
         		for(var i = 0;i < data.length;i++) { 
			%>

			<tr>
				<td><%=(i+1)%></td>
				<td><%=data[i].member_username%></td>
				<td><%=data[i].member_name%></td>
				<td><%=data[i].member_password%></td>
				<td><%=data[i].club_name%></td>
				<td>
					<a class="a-inside edit" href="/member_page/<%=data[i].member_id%>">Edit</a>

					<a class="a-inside delete" href="javascript:void(0)"
						onClick="deleteUser(<%=data[i].member_id%>)">Delete</a>

				</td>
			</tr>
			<% }
    
     }else{ %>
			<tr>
				<td colspan="5">No Data</td>
			</tr>
			<% } %>

		</table>
	</div>
	<div class="page-data">

		<form method="post" action="" id="the-form">
			<p>Insert New Member</p>
			<table cellpadding="11">
				<tr>
					<td class="label">UserName</td>
					<td>: <input type="text" name="member_username"></td>
				</tr>
				<tr>
					<td class="label">Name</td>
					<td>: <input type="text" name="member_name"></td>
				</tr>
				<tr>
					<td class="label">Password</td>
					<td>: <input type="password" name="member_password"></td>
				</tr>
				<tr>
					<td class="label"></td>
					<td>
						&nbsp; <input type="button" value="Save" onClick="saveUser()">
					</td>
				</tr>
			</table>
		</form>
	</div>
	<div class="page-data">
		<ul class="err-area"></ul>
	</div>

	<script>
		function saveUser() {
			$.ajax({
				url: "/member_page",
				type: "post",
				data: $("#the-form").serialize(),
				success: function (res) {
					window.location.reload();
					return false;
				},
				error: function (xhr, status, error) {
					console.log(xhr.responseText);
					var err = '';
					$.each(JSON.parse(xhr.responseText), function (i, item) {
						err += '<li>' + item.msg + '</li>';
					});
					$(".err-area").html(err);
					return false;
				}

			});
		}

		function deleteUser(member_id) {
			$.ajax({
				url: "/member_page/" + member_id,
				type: 'DELETE',
				success: function (res) {
					window.location.reload();
					return false;
				},
				error: function (xhr, status, error) {

					console.log(xhr.responseText);
					alert("Error deleting");
					return false;
				}
			});
		}

	</script>
</body>

</html>